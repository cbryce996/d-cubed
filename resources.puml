@startuml
title Resource System

left to right direction
skinparam componentStyle rectangle
skinparam shadowing true
skinparam roundcorner 14
skinparam defaultTextAlignment center

skinparam DefaultFontSize 8
skinparam ArrowFontSize 7
skinparam ArrowThickness 0.9

skinparam RectangleFontColor #1A1F2B
skinparam RectangleBorderColor #2F3A4A

skinparam RectangleBackgroundColor<<Policy>>  #E8F1FF
skinparam RectangleBackgroundColor<<Backend>> #F1E8FF
skinparam RectangleBackgroundColor<<Store>>   #E9FAF1
skinparam RectangleBackgroundColor<<Client>>  #FFF6E7
skinparam RectangleBackgroundColor<<Data>>    #F4F6F9

skinparam RectangleBorderColor<<Policy>>  #2E6BE6
skinparam RectangleBorderColor<<Backend>> #7B3FE4
skinparam RectangleBorderColor<<Store>>   #2FAE6B
skinparam RectangleBorderColor<<Client>>  #E08A00
skinparam RectangleBorderColor<<Data>>    #6A7686

package "resources" {
  rectangle "State\n//(Key)//" as STATE <<Data>>
  rectangle "Handle\n//(id, gen)//" as HANDLE <<Data>>

  rectangle "Cache\n//Key→Handle//" as CACHE <<Policy>>
  rectangle "Pool\n//Key→[Handle]//" as POOL <<Policy>>

  rectangle "SlotMap\n//Dense Store//" as STORE <<Store>>
  rectangle "Resource" as RESOURCE <<Store>>

  package "backend" {
    rectangle "Factory\n//Create/Destroy//" as FACTORY <<Backend>>
    rectangle "SDL_GPU\n//Texture//" as SDLGPU <<Backend>>
  }
}

package "render" {
  rectangle "Pass" as PASS <<Client>>
  rectangle "Target\n//Double-Buffer//" as TARGET <<Client>>
  rectangle "Pipeline" as PIPELINE <<Client>>
}

CACHE  ..> FACTORY : call
POOL   ..> FACTORY : call
FACTORY ..> STORE  : allocate
FACTORY ..> SDLGPU  : creates
STORE  ..> SDLGPU  : owns
PASS   ..> TARGET
PASS   ..> PIPELINE
TARGET ..> POOL    : acquire/release
PIPELINE ..> CACHE : get/create/clear

HANDLE ..> RESOURCE
HANDLE <.. STORE
STATE  ..> RESOURCE
RESOURCE ..> CACHE
RESOURCE ..> POOL
@enduml
